window.__require=function t(e,n,o){function i(c,s){if(!n[c]){if(!e[c]){var a=c.split("/");if(a=a[a.length-1],!e[a]){var u="function"==typeof __require&&__require;if(!s&&u)return u(a,!0);if(r)return r(a,!0);throw new Error("Cannot find module '"+c+"'")}c=a}var h=n[c]={exports:{}};e[c][0].call(h.exports,function(t){return i(e[c][1][t]||t)},h,h.exports,t,e,n,o)}return n[c].exports}for(var r="function"==typeof __require&&__require,c=0;c<o.length;c++)i(o[c]);return i}({anim:[function(t,e,n){"use strict";cc._RF.push(e,"c1a23/FDA5BXKhzdnCenA9q","anim");var o=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),i=this&&this.__decorate||function(t,e,n,o){var i,r=arguments.length,c=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(c=(r<3?i(c):r>3?i(e,n,c):i(e,n))||c);return r>3&&c&&Object.defineProperty(e,n,c),c};Object.defineProperty(n,"__esModule",{value:!0}),n.Anim=void 0;var r=cc._decorator.ccclass,c=t("../../../common/scripts/util"),s=t("./writenumber"),a=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e._position=null,e._containerNode=null,e._component=null,e._movedToRightPos=!1,e._animRunning=!1,e._touchEnabled=!1,e}return o(e,t),e.prototype.onLoad=function(){this.enableTouchHandlers(),this.node.scale=0,this._anim=this.node.getComponent(cc.Animation)},e.prototype.enableTouchHandlers=function(){this.node.on(c.TouchEvents.TOUCH_START,this.onTouchStart,this),this.node.on(c.TouchEvents.TOUCH_END,this.onTouchEnd,this)},e.prototype.disableTouchHandlers=function(){this.node.off(c.TouchEvents.TOUCH_START,this.onTouchStart,this),this.node.off(c.TouchEvents.TOUCH_END,this.onTouchEnd,this)},e.prototype.onTouchStart=function(t){this._component.touchAllowedOnAnimLayout&&this._movedToRightPos&&(this._touchEnabled||(this._touchEnabled=!0,this._component.updateSpeakCount(),this.animateOffScreen(),c.Util.speakEquation([String(this._component.speakCount)],function(t){})))},e.prototype.animateOffScreen=function(){var t=this,e=c.Util.randomBetween(0,.3*cc.winSize.width);(new cc.Tween).target(this.node).to(1,{opacity:255,x:e,y:cc.winSize.width},{progress:null,easing:"cubicOut"}).call(function(){t.scheduleOnce(function(){t._component.updateAnimationIndexCount()},.1)}).start()},e.prototype.onTouchEnd=function(t){},e.prototype.animateToScreen=function(){var t=this;this._animRunning=!0,this._anim.play("fly1"),(new cc.Tween).target(this.node).to(1.5,{scaleX:-1,scaleY:1,opacity:255,x:this._position.x,y:this._position.y},{progress:null,easing:"quadOut"}).call(function(){t._movedToRightPos=!0,t._anim.stop(),t._animRunning=!1}).start()},Object.defineProperty(e.prototype,"containerNode",{set:function(t){this._containerNode=t,this._component=this._containerNode.getComponent(s.WriteNumber)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"position",{set:function(t){this._position=t},enumerable:!1,configurable:!0}),e.prototype.update=function(t){this._component.touchAllowedOnAnimLayout&&!this._animRunning&&(this._animRunning=!0,this._anim.play("fly1"))},e=i([r],e)}(cc.Component);n.Anim=a,cc._RF.pop()},{"../../../common/scripts/util":void 0,"./writenumber":"writenumber"}],writenumber:[function(t,e,n){"use strict";cc._RF.push(e,"c8092ykRKdHVY+mvluDmXHA","writenumber");var o=this&&this.__extends||function(){var t=function(e,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(e,n)};return function(e,n){function o(){this.constructor=e}t(e,n),e.prototype=null===n?Object.create(n):(o.prototype=n.prototype,new o)}}(),i=this&&this.__decorate||function(t,e,n,o){var i,r=arguments.length,c=r<3?e:null===o?o=Object.getOwnPropertyDescriptor(e,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,o);else for(var s=t.length-1;s>=0;s--)(i=t[s])&&(c=(r<3?i(c):r>3?i(e,n,c):i(e,n))||c);return r>3&&c&&Object.defineProperty(e,n,c),c};Object.defineProperty(n,"__esModule",{value:!0}),n.WriteNumber=n.NUMBER_TRACING_TEXTURE=void 0;var r=cc._decorator.ccclass,c=cc._decorator.property,s=cc.Layout,a=t("../../../common/scripts/lib/config"),u=t("../../../common/scripts/util"),h=t("./anim"),l=t("../../../common/scripts/lib/error-handler"),d=t("../../../common/scripts/helper"),p=t("../../../common/Tracing/scripts/singlelettertracing");n.NUMBER_TRACING_TEXTURE="games/writenumber/textures/";var _=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.wordsPrefab=null,e.animsPrefab=null,e.progressMonitorPrefab=null,e.singleLetterPrefab=null,e.imageNode=null,e._currentConfig=null,e._numericTracingContainer=null,e._sound=null,e._words=null,e._anims=null,e._dog=null,e.friend=null,e._currentLetterIndex=0,e._touchAllowedOnAnimLayout=!1,e._shouldShowAnimSprite=!0,e._animationFinishIndex=0,e}return o(e,t),e.prototype.onLoad=function(){var t=this;if(cc.director.getCollisionManager().enabled=!0,this._shouldShowAnimSprite=!0,this._shouldShowAnimSprite&&(this._dog=this.node.getChildByName("dog"),u.Util.loadFriend(function(e){t.friend=e.getComponent(dragonBones.ArmatureDisplay),t._dog.addChild(e),t._dog.setPosition(new cc.Vec2(cc.winSize.width/3,-1e3)),t._dog.scaleX=-.6,t._dog.scaleY=.6,t._dog.opacity=0,(new cc.Tween).target(t._dog).to(.25,{position:new cc.Vec2(cc.winSize.width/3,-cc.winSize.height/2)},{progress:null,easing:"quadOut"}).call(function(){t._dog.opacity=255,null!=t.friend&&t.friend.playAnimation("throw",1),t.scheduleOnce(function(){t.buildAnimSprites(),t.scheduleOnce(function(){t._words.opacity=255,(new cc.Tween).target(t._dog).to(2,{position:new cc.Vec2(cc.winSize.width/3,2*-cc.winSize.height)},{progress:null,easing:"quadOut"}).start()},2)},.65)}).start()})),this._currentConfig=this.processConfiguration(a.default.getInstance().data[0]),null!==this._currentConfig){this._words=cc.instantiate(this.wordsPrefab),this.node.addChild(this._words);var e=(this._characters.length,.4),n=3===this._characters.length?660:2===this._characters.length?465:400;this._words.setPosition(new cc.Vec2(e*cc.winSize.width-n,100)),this._anims=cc.instantiate(this.animsPrefab),this.node.addChild(this._anims),this._anims.setPosition(new cc.Vec2(-cc.winSize.width/4,0)),this._anims.width=(1-e)*cc.winSize.width,this._anims.height=cc.winSize.height,this._numericTracingContainer=this.node,this._numericTracingContainer.scale*=1,this.node.width=cc.winSize.width,this.node.height=cc.winSize.height,this._speakCount=0,this._words.opacity=this._shouldShowAnimSprite?0:255,this.buildNumbers(),this.subScribeToTracingEvents(),this.node.emit(d.CONFIG_LOADED),this.loadSounds(this._currentConfig.count),this.emitLetterEnabledEvent(this._layout.node.getChildByName(this._originalLetterName+"0"),0)}},e.prototype.createSprite=function(t,e){var n=cc.instantiate(this.imageNode);n.setPosition(new cc.Vec2(850,200)),n.scale=0,n.opacity=255;var o=n.getComponent(h.Anim);t.addChild(n),o.containerNode=this.node,o.position=e,o.animateToScreen()},e.prototype.buildNumbers=function(){this.buildLayout()},e.prototype.buildLayout=function(){var t=this;this._layout=this._words.getComponent(cc.Layout),this._layout.node.zIndex=2,this._layout.spacingX=20,this._layout.spacingY=0,this._layout.resizeMode=s.ResizeMode.CONTAINER,this._words.setPosition(new cc.Vec2(this._words.getPosition().x,this._words.getPosition().y-50)),this._words.scale=.95,this._characters.forEach(function(e,n){var o=cc.instantiate(t.singleLetterPrefab);o.height=768,o.scale=1.25,t._originalLetterName=o.name,o.name=t._originalLetterName+n;var i=o.getComponent(p.SingleLetterTracing);i.wordTracingContainer=t.node,i.order=n,i.letter=e,t._layout.node.addChild(o),0===n&&(t._currentLetterIndex=n)}),this._layout.updateLayout()},e.prototype.buildAnimSprites=function(){this._animLayout=this._anims.getComponent(cc.Layout),this._animLayout.node.width=425,this._animLayout.node.setPosition(new cc.Vec2(-512,-350)),this._animLayout.type=s.Type.NONE,this._animLayout.resizeMode=s.ResizeMode.NONE,this._anims.scale=.85,this.generateAnimSprites(Number(this._currentConfig.count)),this._animLayout.updateLayout()},e.prototype.generateAnimSprites=function(t){Math.ceil(t/2),Math.floor(350/t);for(var e=t<3?400:Math.floor(800/Math.ceil(.5*t)),n=0;n<t;n++){var o=n%2==0?100:300;this.createSprite(this._animLayout.node,new cc.Vec2(o,e+e*Math.floor(n/2)))}},e.prototype.loadSounds=function(t){var e=this;u.Util.loadNumericSound(t,function(t){e._sound=t,e.node.emit(d.SOUND_LOADED_EVENT)})},e.prototype.subScribeToTracingEvents=function(){var t=this;this.node.on(d.TRACING_FINISHED,function(e){e.stopPropagation(),t.tracingFinished()}),this.node.on(d.TRACING_CORRECT,function(e){e.stopPropagation(),t.node.emit("correct")}),this.node.on(d.TRACING_WRONG,function(e){e.stopPropagation(),t.node.emit("wrong")})},e.prototype.emitLetterEnabledEvent=function(t,e){t.emit("letterEnabledEvent",e,1)},e.prototype.tracingFinished=function(){this.pronounceAndTrigger()},e.prototype.individualLetterSound=function(){this._characters.length>1&&this._layout.node.getChildByName(this._originalLetterName+(this._currentLetterIndex-1)).getComponent(p.SingleLetterTracing).pronounce()},e.prototype.pronounceAndTrigger=function(){var t=this;this._currentLetterIndex++,this.individualLetterSound(),this._currentLetterIndex===this._characters.length?this.scheduleOnce(function(){try{t._sound&&(t._soundID=u.Util.play(t._sound,!1))}catch(t){}t.scheduleOnce(function(){t._touchAllowedOnAnimLayout=!0},.1)},1):this.emitLetterEnabledEvent(this._layout.node.getChildByName(this._originalLetterName+this._currentLetterIndex),this._currentLetterIndex)},e.prototype.processConfiguration=function(t){void 0===t&&(t=[]);var e=[].concat.apply([],t),n=e[0],o=e[1],i=e[2],r=e[3];return this._characters=Array.from(r),{level:n,workSheet:o,problemNo:i,count:r}},e.prototype.onDestroy=function(){cc.audioEngine.stopAllEffects()},e.prototype.moveToNext=function(){this._animationFinishIndex===Number(this._currentConfig.count)&&this._speakCount===Number(this._currentConfig.count)&&this.node.emit("nextProblem")},e.prototype.updateSpeakCount=function(){this._speakCount<Number(this._currentConfig.count)&&this._speakCount++},e.prototype.updateAnimationIndexCount=function(){this._animationFinishIndex<Number(this._currentConfig.count)&&this._animationFinishIndex++,this._animationFinishIndex===Number(this._currentConfig.count)&&this.moveToNext()},Object.defineProperty(e.prototype,"speakCount",{get:function(){return this._speakCount},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"touchAllowedOnAnimLayout",{get:function(){return this._touchAllowedOnAnimLayout},enumerable:!1,configurable:!0}),i([c(cc.Prefab)],e.prototype,"wordsPrefab",void 0),i([c(cc.Prefab)],e.prototype,"animsPrefab",void 0),i([c(cc.Prefab)],e.prototype,"progressMonitorPrefab",void 0),i([c(cc.Prefab)],e.prototype,"singleLetterPrefab",void 0),i([c(cc.Prefab)],e.prototype,"imageNode",void 0),i([l.default()],e.prototype,"onLoad",null),i([l.default()],e.prototype,"createSprite",null),i([l.default()],e.prototype,"buildNumbers",null),i([l.default()],e.prototype,"buildLayout",null),i([l.default()],e.prototype,"buildAnimSprites",null),i([l.default()],e.prototype,"generateAnimSprites",null),i([l.default()],e.prototype,"subScribeToTracingEvents",null),i([l.default()],e.prototype,"emitLetterEnabledEvent",null),i([l.default()],e.prototype,"tracingFinished",null),i([l.default()],e.prototype,"individualLetterSound",null),i([l.default()],e.prototype,"pronounceAndTrigger",null),e=i([r],e)}(cc.Component);n.WriteNumber=_,cc._RF.pop()},{"../../../common/Tracing/scripts/singlelettertracing":void 0,"../../../common/scripts/helper":void 0,"../../../common/scripts/lib/config":void 0,"../../../common/scripts/lib/error-handler":void 0,"../../../common/scripts/util":void 0,"./anim":"anim"}]},{},["anim","writenumber"]);