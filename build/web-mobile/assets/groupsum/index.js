window.__require=function t(o,e,n){function i(r,h){if(!e[r]){if(!o[r]){var s=r.split("/");if(s=s[s.length-1],!o[s]){var a="function"==typeof __require&&__require;if(!h&&a)return a(s,!0);if(c)return c(s,!0);throw new Error("Cannot find module '"+r+"'")}r=s}var l=e[r]={exports:{}};o[r][0].call(l.exports,function(t){return i(o[r][1][t]||t)},l,l.exports,t,o,e,n)}return e[r].exports}for(var c="function"==typeof __require&&__require,r=0;r<n.length;r++)i(n[r]);return i}({ball:[function(t,o,e){"use strict";cc._RF.push(o,"c5b8dPAkWlICI8Qm3q02Ske","ball");var n=this&&this.__extends||function(){var t=function(o,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)o.hasOwnProperty(e)&&(t[e]=o[e])})(o,e)};return function(o,e){function n(){this.constructor=o}t(o,e),o.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),i=this&&this.__decorate||function(t,o,e,n){var i,c=arguments.length,r=c<3?o:null===n?n=Object.getOwnPropertyDescriptor(o,e):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,o,e,n);else for(var h=t.length-1;h>=0;h--)(i=t[h])&&(r=(c<3?i(r):c>3?i(o,e,r):i(o,e))||r);return c>3&&r&&Object.defineProperty(o,e,r),r};Object.defineProperty(e,"__esModule",{value:!0});var c=t("./groupsum"),r=t("../../../common/scripts/lib/error-handler"),h=cc._decorator,s=h.ccclass,a=(h.property,function(t){function o(){var o=null!==t&&t.apply(this,arguments)||this;return o.homePos=null,o.box1Rect=null,o.box2Rect=null,o.hasTouchEnd=!1,o.hasTouchCanceled=!1,o.hasPlacedBallWrong=!1,o.hasTouchMoved=!1,o}return n(o,t),o.prototype.onLoad=function(){cc.director.getPhysicsManager().enabled=!0,this.node.on("touchstart",this.onTouchStart,this),this.node.on("touchend",this.onTouchCancel,this),this.node.on("touchmove",this.onTouchMove,this),this.node.on("touchcancel",this.onTouchCancel,this)},o.prototype.onDestroy=function(){this.node.off("touchstart",this.onTouchStart,this),this.node.off("touchmove",this.onTouchMove,this),this.node.off("touchend",this.onTouchCancel,this),this.node.off("touchcancel",this.onTouchCancel,this)},o.prototype.onTouchStart=function(t){0==t.getID()&&(this.node.getComponent(cc.PhysicsCircleCollider).sensor=!0,this.hasTouchEnd=!1,this.touchedBallName=this.node.name,this.node.getComponent(cc.RigidBody).active=!1,this.node.parent.getComponent(c.default).draggedBall=this.node.name,this.node.parent.getComponent(c.default).checkFinishCtl(!1,!0),this.node.zIndex=1)},o.prototype.onTouchMove=function(t){0==t.getID()&&(this.hasTouchMoved=!0,this.node.getComponent(cc.RigidBody).node.setPosition(this.node.position.add(t.getDelta())),this.node.position.y<-cc.winSize.height/2+60&&(this.touchFinished(t),this.hasTouchCanceled=!0,this.node.off("touchmove",this.onTouchMove,this)))},o.prototype.onTouchCancel=function(t){this.hasTouchCanceled?(cc.log("hi new test "),this.hasTouchCanceled=!1,this.node.on("touchmove",this.onTouchMove,this)):this.touchFinished(t)},o.prototype.touchFinished=function(t){var o=this.node.parent.getChildByName("tub1");this.node.y<o.getPosition().y-o.height/2?this.node.parent.getComponent(c.default).checkFinishCtl(!0,!1):this.node.parent.getComponent(c.default).checkFinishCtl(!1,!1),this.node.getComponent(cc.PhysicsCircleCollider).sensor=!1,this.node.getComponent(cc.RigidBody).active=!0,this.hasTouchEnd=!0,this.hasTouchMoved&&(this.hasTouchMoved=!1,this.node.getBoundingBoxToWorld().intersects(o.getChildByName("covering collider").getBoundingBoxToWorld())?this.hasPlacedBallWrong=!0:null!=this.node.parent.getChildByName("tub2")&&this.node.getBoundingBoxToWorld().intersects(this.node.parent.getChildByName("tub2").getChildByName("covering collider").getBoundingBoxToWorld())&&(this.hasPlacedBallWrong=!0)),this.node.parent.getComponent(c.default).draggedBall=""},o.prototype.handleNodeTouch=function(t){"off"==t?(this.node.off("touchstart",this.onTouchStart,this),this.node.off("touchend",this.onTouchCancel,this),this.node.off("touchmove",this.onTouchMove,this),this.node.off("touchcancel",this.onTouchCancel,this)):"on"==t&&(this.node.on("touchstart",this.onTouchStart,this),this.node.on("touchend",this.onTouchCancel,this),this.node.on("touchmove",this.onTouchMove,this),this.node.on("touchcancel",this.onTouchCancel,this))},o.prototype.onBeginContact=function(t,o,e){var n=o.node.getComponent(cc.RigidBody).linearVelocity.y;cc.log("wrong"+this.hasPlacedBallWrong),this.hasPlacedBallWrong&&("colliderLine"==e.node.name?(t.disabled=!1,this.hasPlacedBallWrong=!1):(e.node.name.startsWith("tub")||"ball"==e.node.name)&&(t.disabled=!0)),this.hasTouchEnd&&(n<-110&&!t.disabled&&this.node.parent.getComponent(c.default).playBallAudio(),n>-21&&this.node.parent.getComponent(c.default).checkFinishCtl(!0,!1))},i([r.catchError()],o.prototype,"onLoad",null),i([r.catchError()],o.prototype,"onDestroy",null),i([r.catchError()],o.prototype,"onTouchStart",null),i([r.catchError()],o.prototype,"onTouchMove",null),i([r.catchError()],o.prototype,"onTouchCancel",null),i([r.catchError()],o.prototype,"touchFinished",null),i([r.catchError()],o.prototype,"handleNodeTouch",null),i([r.catchError()],o.prototype,"onBeginContact",null),o=i([s],o)}(cc.Component));e.default=a,cc._RF.pop()},{"../../../common/scripts/lib/error-handler":void 0,"./groupsum":"groupsum"}],groupsum:[function(t,o,e){"use strict";cc._RF.push(o,"39b92yLE6tEi65ekAba27Th","groupsum");var n=this&&this.__extends||function(){var t=function(o,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)o.hasOwnProperty(e)&&(t[e]=o[e])})(o,e)};return function(o,e){function n(){this.constructor=o}t(o,e),o.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),i=this&&this.__decorate||function(t,o,e,n){var i,c=arguments.length,r=c<3?o:null===n?n=Object.getOwnPropertyDescriptor(o,e):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,o,e,n);else for(var h=t.length-1;h>=0;h--)(i=t[h])&&(r=(c<3?i(r):c>3?i(o,e,r):i(o,e))||r);return c>3&&r&&Object.defineProperty(o,e,r),r};Object.defineProperty(e,"__esModule",{value:!0}),e.GROUND=void 0;var c=t("./ball"),r=t("../../../common/scripts/lib/config"),h=t("../../../common/scripts/util"),s=t("../../../common/scripts/lib/error-handler"),a=cc._decorator,l=a.ccclass,d=a.property;e.GROUND=50;var u=function(t){function o(){var o=null!==t&&t.apply(this,arguments)||this;return o.ballAudio=null,o.clearAudio=null,o.ballPrefab=null,o.boxPrefab=null,o.tubPrefab=null,o.helpLabelPrefab=null,o.boxIndex=[3,4,5,6,7,8],o.tub2Count=0,o.groundBallCount=0,o.totalPieces=0,o.count=0,o.isScrolling=!1,o.draggedBall="",o.firstDrag=null,o.firstDrop=null,o.hasScrollComplete=!1,o}return n(o,t),o.prototype.onLoad=function(){var t=r.default.getInstance().data[0];cc.director.getPhysicsManager().enabled=!0,this.animAudio("problem_clear"),this.totalPieces++,cc.log(t),this.boxHomePos=new Map,this.ballCurrentPlace=new Map,this.audioName=[];var o=t.toString().split(",");this.mode="true"==o[8]?"subtraction":"addition",this.showAnswer="true"==o[9],this.tub1Count=+o[3],this.tub2Count=+o[5],this.groundBallCount=+o[5],this.totalCount=this.tub1Count+this.tub2Count,this.finishCount=this.showAnswer?3:5,this.firstDrop=new cc.Node;for(var n,i,s=3;s<8;)this.audioName.push(o[s]),s++;cc.log(o[3]+o[4]+o[8]+this.mode);var a=-cc.winSize.height/2+200+e.GROUND;"addition"==this.mode?((n=cc.instantiate(this.tubPrefab)).name="tub1",this.node.addChild(n),(i=cc.instantiate(this.tubPrefab)).name="tub2",this.node.addChild(i),n.getComponent(cc.RigidBody).node.position=cc.v2(-300,a),n.getChildByName("colliderLine").getComponent(cc.RigidBody).node.position=cc.v2(0,a),i.getComponent(cc.RigidBody).node.position=cc.v2(300,a),i.getChildByName("colliderLine").getComponent(cc.RigidBody).node.position=cc.v2(0,a),this.firstDrop.parent=n,this.firstDrop.y+=n.y+380):((n=cc.instantiate(this.tubPrefab)).name="tub1",this.node.addChild(n),n.getComponent(cc.RigidBody).node.position=cc.v2(0,a),n.getChildByName("colliderLine").getComponent(cc.RigidBody).node.position=cc.v2(0,a),this.firstDrop.parent=n,this.firstDrop.position=cc.v2(-350,-150));var l=this.node.getChildByName("tub1").getBoundingBox(),d=this.totalCount;"subtraction"==this.mode&&(d=+o[3]);for(var u=0,p=l.y+45;u<d;u++){var g=cc.instantiate(this.ballPrefab),f=g.getComponent(c.default);this.node.addChild(g),0==u&&(this.firstDrag=g),"subtraction"==this.mode?(f.mode=this.mode,f.name=u.toString(),f.homeName="tub1",f.box1Rect=l,u%6==5&&(p+=10+g.height),g.position=cc.v2(l.x+u%6*(g.width-5)+130,p),f.homePos=g.position):(g.position=cc.v2(Math.random()*cc.winSize.width-cc.winSize.width/2,-cc.winSize.height/2+80),f.homePos=g.position,f.homeName="ground",f.mode=this.mode,f.name=u.toString(),f.box1Rect=l,f.box2Rect=this.node.getChildByName("tub2").getBoundingBox())}var y=cc.instantiate(this.helpLabelPrefab),m=cc.instantiate(this.helpLabelPrefab),b=cc.instantiate(this.helpLabelPrefab),C=cc.instantiate(this.helpLabelPrefab);y.getComponent(cc.Label).string=o[3],m.getComponent(cc.Label).string=o[5],b.getComponent(cc.Label).string=o[3],C.getComponent(cc.Label).fontSize=35,"subtraction"==this.mode?(y.getComponent(cc.Label).fontSize=35,y.opacity=0,b.parent=n,b.position=cc.v2(l.origin.x-7,l.height-70),y.parent=n,y.name="help1",C.parent=n,C.name="help4",y.position=cc.v2(l.width/2-80,l.height/2-80),C.position=cc.v2(100,-l.height/2-20),m.parent=n,m.position=cc.v2(-310,-75),m.zIndex=1):(y.parent=this.node,y.position=l.center,m.parent=this.node,m.position=this.node.getChildByName("tub2").getBoundingBox().center);var B=new cc.Node;this.node.addChild(B),B.position=cc.v2(0,0),B.name="box_slot";for(u=0,p=3;u<5;u++,p++){var v=cc.instantiate(this.boxPrefab);B.addChild(v),v.position=cc.v2(150*u-300,-460),v.name=o[p],!this.showAnswer||"="!=o[p]&&"+"!=o[p]&&"-"!=o[p]||(v.getChildByName("label").getComponent(cc.Label).string=o[p],v.name=o[p]+"_operator")}this.boxIndex=this.shuffle(this.boxIndex);for(var T=Math.round(this.getRandom(1,9));T==+o[3]||T==+o[5]||T==+o[7];)T=Math.round(this.getRandom(1,9));this.notCompare=T.toString();for(u=0,p=3;u<6;u++){v=cc.instantiate(this.boxPrefab);B.addChild(v),v.position=cc.v2(150*u-300-60,-600),8!=this.boxIndex[u]?(v.getChildByName("label").getComponent(cc.Label).string=o[this.boxIndex[u]],this.boxHomePos.set("choice_"+u.toString()+o[this.boxIndex[u]],v.position),v.name="choice_"+u.toString()+o[this.boxIndex[u]]):(v.getChildByName("label").getComponent(cc.Label).string=T.toString(),v.name="choice_"+u.toString()+T.toString(),this.boxHomePos.set("choice_"+u.toString()+T.toString(),v.position)),v.on(h.TouchEvents.TOUCH_START,this.onTouchStarted,this),v.on(h.TouchEvents.TOUCH_MOVE,this.onTouchMoved,this),v.on(h.TouchEvents.TOUCH_END,this.onTouchEnded,this),v.on(h.TouchEvents.TOUCH_CANCEL,this.onTouchEnded,this)}h.Util.showHelp(this.firstDrag,this.firstDrop)},o.prototype.shuffle=function(t){for(var o,e,n=t.length;0!==n;)e=Math.floor(Math.random()*n),o=t[n-=1],t[n]=t[e],t[e]=o;return t},o.prototype.getRandom=function(t,o){return Math.random()*(o-t)+t},o.prototype.playBallAudio=function(){cc.audioEngine.isMusicPlaying()||h.Util.playSfx(this.ballAudio)},o.prototype.animAudio=function(t){cc.audioEngine.isMusicPlaying()||h.Util.playSfx(this.clearAudio)},o.prototype.onDestroy=function(){cc.audioEngine.stopAllEffects()},o.prototype.checkFinishCtl=function(t,o){this.Callback=function(){this.checkFinish(!0)},this.Callback&&this.unscheduleAllCallbacks(),t&&(o?this.checkFinish(!1):this.scheduleOnce(this.Callback,.5))},o.prototype.checkFinish=function(t){var o,e=this.node.getChildByName("tub1").getChildByName("collider");"addition"==this.mode&&(o=this.node.getChildByName("tub2").getChildByName("collider")),cc.log("final fn "+t+this.draggedBall+"Count: "+cc.director.getPhysicsManager().testAABB(this.node.getChildByName("tub1").getChildByName("collider").getBoundingBoxToWorld()).length+" diff_1 "+cc.director.getPhysicsManager().testAABB(this.node.getChildByName("tub1").getChildByName("collider").getChildByName("diff_1").getBoundingBoxToWorld()).length+" diff2 "+cc.director.getPhysicsManager().testAABB(this.node.getChildByName("tub1").getChildByName("collider").getChildByName("diff_2").getBoundingBoxToWorld()).length);var n=this.ballsInTub(e);"subtraction"==this.mode?(this.tub1Count-n==0?(this.node.getChildByName("tub1").getChildByName("help1").opacity=0,this.node.getChildByName("tub1").getChildByName("help4").opacity=0):(this.node.getChildByName("tub1").getChildByName("help1").opacity=255,this.node.getChildByName("tub1").getChildByName("help4").opacity=255,this.node.getChildByName("tub1").getChildByName("help1").getComponent(cc.Label).string=n.toString(),this.node.getChildByName("tub1").getChildByName("help4").getComponent(cc.Label).string=(this.tub1Count-n).toString()),n==this.tub1Count-this.groundBallCount&&t&&this.scrollScene()):t&&this.tub1Count==n&&this.tub2Count==this.ballsInTub(o)&&this.scrollScene()},o.prototype.ballsInTub=function(t){var o=cc.director.getPhysicsManager().testAABB(t.getBoundingBoxToWorld()),e=cc.director.getPhysicsManager().testAABB(t.getChildByName("diff_1").getBoundingBoxToWorld()).concat(cc.director.getPhysicsManager().testAABB(t.getChildByName("diff_2").getBoundingBoxToWorld()));return o.length-e.length},o.prototype.scrollScene=function(){var t=this;if(!this.isScrolling){this.isScrolling=!0,this.node.getComponentsInChildren(c.default).forEach(function(t){t.handleNodeTouch("off")});var o=this.node.getChildByName("box_slot");(new cc.Tween).target(o).to(2,{position:cc.v2(o.x,o.y+745)},{progress:null,easing:"bounceOut"}).call(function(){return t.hasScrollComplete=!0}).start()}},o.prototype.onTouchStarted=function(t){0==t.getID()&&this.hasScrollComplete&&(t.currentTarget.scale=1.1)},o.prototype.onTouchMoved=function(t){0==t.getID()&&this.hasScrollComplete&&(t.currentTarget.position=t.currentTarget.position.add(t.getDelta()))},o.prototype.onTouchEnded=function(t){var o,e=this,n=t.currentTarget.getChildByName("label").getComponent(cc.Label).string,i=!1;this.node.getChildByName("box_slot").children.forEach(function(e){e.name==n&&e.getBoundingBox().contains(t.currentTarget)&&(e.name="done"+e.name,o=e.getBoundingBox(),i=!0)}),n!=this.notCompare&&i?(this.node.emit("correct"),t.currentTarget.scale=1,t.currentTarget.position=o.center,t.currentTarget.name="done_"+n,t.currentTarget.off(cc.Node.EventType.TOUCH_START,this.onTouchStarted,this),t.currentTarget.off(cc.Node.EventType.TOUCH_MOVE,this.onTouchMoved,this),t.currentTarget.off(cc.Node.EventType.TOUCH_END,this.onTouchEnded,this),t.currentTarget.off(cc.Node.EventType.TOUCH_CANCEL,this.onTouchEnded,this),0==--this.finishCount&&(this.node.getChildByName("box_slot").children.forEach(function(t){t.name.startsWith("choice")&&(t.off("touchstart",e.onTouchStarted,e),t.off("touchmove",e.onTouchMoved,e),t.off("touchend",e.onTouchEnded,e),t.off("touchcancel",e.onTouchEnded,e))}),this.scheduleOnce(function(){h.Util.speakEquation(e.audioName,function(t){t+1==e.audioName.length&&e.node.emit("nextProblem")})},1)),t.currentTarget.scale=1):(this.node.emit("wrong"),(new cc.Tween).target(t.currentTarget).to(.3,{position:this.boxHomePos.get(t.currentTarget.name),scale:1},{progress:null,easing:function(t){return t}}).start())},i([d({type:cc.AudioClip})],o.prototype,"ballAudio",void 0),i([d(cc.AudioClip)],o.prototype,"clearAudio",void 0),i([d(cc.Prefab)],o.prototype,"ballPrefab",void 0),i([d(cc.Prefab)],o.prototype,"boxPrefab",void 0),i([d(cc.Prefab)],o.prototype,"tubPrefab",void 0),i([d(cc.Prefab)],o.prototype,"helpLabelPrefab",void 0),i([s.catchError()],o.prototype,"onLoad",null),i([s.catchError()],o.prototype,"shuffle",null),i([s.catchError()],o.prototype,"getRandom",null),i([s.catchError()],o.prototype,"playBallAudio",null),i([s.catchError()],o.prototype,"animAudio",null),i([s.catchError()],o.prototype,"onDestroy",null),i([s.catchError()],o.prototype,"checkFinishCtl",null),i([s.catchError()],o.prototype,"checkFinish",null),i([s.catchError()],o.prototype,"ballsInTub",null),i([s.catchError()],o.prototype,"scrollScene",null),i([s.catchError()],o.prototype,"onTouchStarted",null),i([s.catchError()],o.prototype,"onTouchMoved",null),i([s.catchError()],o.prototype,"onTouchEnded",null),o=i([l],o)}(cc.Component);e.default=u,cc._RF.pop()},{"../../../common/scripts/lib/config":void 0,"../../../common/scripts/lib/error-handler":void 0,"../../../common/scripts/util":void 0,"./ball":"ball"}],wall:[function(t,o,e){"use strict";cc._RF.push(o,"abf56clOGNFW6BijP3gSPXh","wall");var n=this&&this.__extends||function(){var t=function(o,e){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var e in o)o.hasOwnProperty(e)&&(t[e]=o[e])})(o,e)};return function(o,e){function n(){this.constructor=o}t(o,e),o.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),i=this&&this.__decorate||function(t,o,e,n){var i,c=arguments.length,r=c<3?o:null===n?n=Object.getOwnPropertyDescriptor(o,e):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)r=Reflect.decorate(t,o,e,n);else for(var h=t.length-1;h>=0;h--)(i=t[h])&&(r=(c<3?i(r):c>3?i(o,e,r):i(o,e))||r);return c>3&&r&&Object.defineProperty(o,e,r),r};Object.defineProperty(e,"__esModule",{value:!0});var c=t("../../../common/scripts/lib/error-handler"),r=cc._decorator,h=r.ccclass,s=r.property,a=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return n(o,t),o.prototype.onLoad=function(){switch(cc.director.getPhysicsManager().enabled=!0,this.text){case"ground":this.node.getComponent(cc.PhysicsBoxCollider).size.width=cc.winSize.width,this.node.getComponent(cc.PhysicsBoxCollider).offset.y=-cc.winSize.height/2-250+180;break;case"left":this.node.getComponent(cc.PhysicsBoxCollider).size.height=cc.winSize.height,this.node.getComponent(cc.PhysicsBoxCollider).offset.x=-cc.winSize.width/2-100;break;case"right":this.node.getComponent(cc.PhysicsBoxCollider).size.height=cc.winSize.height,this.node.getComponent(cc.PhysicsBoxCollider).offset.x=cc.winSize.width/2+100}},i([s],o.prototype,"text",void 0),i([c.catchError()],o.prototype,"onLoad",null),o=i([h],o)}(cc.Component);e.default=a,cc._RF.pop()},{"../../../common/scripts/lib/error-handler":void 0}]},{},["ball","groupsum","wall"]);