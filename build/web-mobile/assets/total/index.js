window.__require=function t(o,n,e){function r(c,s){if(!n[c]){if(!o[c]){var u=c.split("/");if(u=u[u.length-1],!o[u]){var a="function"==typeof __require&&__require;if(!s&&a)return a(u,!0);if(i)return i(u,!0);throw new Error("Cannot find module '"+c+"'")}c=u}var l=n[c]={exports:{}};o[c][0].call(l.exports,function(t){return r(o[c][1][t]||t)},l,l.exports,t,o,n,e)}return n[c].exports}for(var i="function"==typeof __require&&__require,c=0;c<e.length;c++)r(e[c]);return r}({"clear-script":[function(t,o,n){"use strict";cc._RF.push(o,"1db42t4HblISpwbpKmB7ohD","clear-script");var e=this&&this.__extends||function(){var t=function(o,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var n in o)o.hasOwnProperty(n)&&(t[n]=o[n])})(o,n)};return function(o,n){function e(){this.constructor=o}t(o,n),o.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}(),r=this&&this.__decorate||function(t,o,n,e){var r,i=arguments.length,c=i<3?o:null===e?e=Object.getOwnPropertyDescriptor(o,n):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,o,n,e);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(c=(i<3?r(c):i>3?r(o,n,c):r(o,n))||c);return i>3&&c&&Object.defineProperty(o,n,c),c};Object.defineProperty(n,"__esModule",{value:!0});var i=cc._decorator.ccclass,c=cc._decorator.property,s=t("../../../common/scripts/lib/error-handler"),u=t("../../../common/scripts/answer-grid"),a=function(t){function o(){var o=null!==t&&t.apply(this,arguments)||this;return o.oneByOne=!0,o}return e(o,t),o.prototype.onButtonClick=function(t,o){var n=new cc.Event.EventCustom(u.CLEAR_BUTTON_CLICKED,!0);n.setUserData({oneByOne:this.oneByOne}),this.node.dispatchEvent(n)},r([c],o.prototype,"oneByOne",void 0),r([s.default()],o.prototype,"onButtonClick",null),o=r([i],o)}(cc.Component);n.default=a,cc._RF.pop()},{"../../../common/scripts/answer-grid":void 0,"../../../common/scripts/lib/error-handler":void 0}],"confirm-script":[function(t,o,n){"use strict";cc._RF.push(o,"39b03+IG5xB1rI0A9kPqHyX","confirm-script");var e=this&&this.__extends||function(){var t=function(o,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var n in o)o.hasOwnProperty(n)&&(t[n]=o[n])})(o,n)};return function(o,n){function e(){this.constructor=o}t(o,n),o.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}(),r=this&&this.__decorate||function(t,o,n,e){var r,i=arguments.length,c=i<3?o:null===e?e=Object.getOwnPropertyDescriptor(o,n):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,o,n,e);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(c=(i<3?r(c):i>3?r(o,n,c):r(o,n))||c);return i>3&&c&&Object.defineProperty(o,n,c),c};Object.defineProperty(n,"__esModule",{value:!0});var i=cc._decorator.ccclass,c=t("../../../common/scripts/lib/error-handler"),s=t("../../../common/scripts/answer-grid"),u=function(t){function o(){return null!==t&&t.apply(this,arguments)||this}return e(o,t),o.prototype.onButtonClick=function(t,o){var n=new cc.Event.EventCustom(s.CONFIRM_BUTTON_CLICKED,!0);this.node.dispatchEvent(n)},r([c.default()],o.prototype,"onButtonClick",null),o=r([i],o)}(cc.Component);n.default=u,cc._RF.pop()},{"../../../common/scripts/answer-grid":void 0,"../../../common/scripts/lib/error-handler":void 0}],"counting-item":[function(t,o,n){"use strict";cc._RF.push(o,"c7c53vOy8hLp7eh3941D851","counting-item");var e=this&&this.__extends||function(){var t=function(o,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var n in o)o.hasOwnProperty(n)&&(t[n]=o[n])})(o,n)};return function(o,n){function e(){this.constructor=o}t(o,n),o.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}(),r=this&&this.__decorate||function(t,o,n,e){var r,i=arguments.length,c=i<3?o:null===e?e=Object.getOwnPropertyDescriptor(o,n):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,o,n,e);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(c=(i<3?r(c):i>3?r(o,n,c):r(o,n))||c);return i>3&&c&&Object.defineProperty(o,n,c),c};Object.defineProperty(n,"__esModule",{value:!0});var i=cc._decorator.ccclass,c=cc._decorator.property,s=t("../../../common/scripts/util"),u=t("../../../common/scripts/lib/error-handler"),a=function(t){function o(){var o=null!==t&&t.apply(this,arguments)||this;return o.loadAudio=null,o.touchAudio=null,o.countingComponent=null,o.isBranches=!1,o._count=null,o}return e(o,t),o.prototype.onLoad=function(){this.registerTouch(),this.hideLabel()},o.prototype.showLabel=function(t){var o=this.node.getChildByName("imageNode");if(o){o.opacity=255;var n=o.getChildByName("labelNode");n.color=(new cc.Color).fromHEX("#654321");var e=n.getComponent(cc.Label),r=this.countingComponent.currentConfig.numberpads[t]||t;n.addComponent(cc.LabelOutline).width=2,e.string=r}},o.prototype.hideLabel=function(){var t=this.node.getChildByName("imageNode");t&&(t.opacity=0)},o.prototype.playLoadingSound=function(){try{this.loadAudio&&s.Util.playSfx(this.loadAudio)}catch(t){}},o.prototype.onTouchStart=function(t){try{this.count()}catch(t){}},o.prototype.bringToFront=function(){this._originZIndex=this.node.zIndex,this.node.zIndex=100},o.prototype.sendBack=function(){this.node.zIndex=this._originZIndex},o.prototype.reCount=function(){this._count=null,this.count(),this.sendBack()},o.prototype.count=function(){try{this.touchAudio&&s.Util.playSfx(this.touchAudio),this.bringToFront(),null===this._count&&(this._count=this.countingComponent.updateCount(this.isBranches?5:1),this.showLabel(String(this._count)))}catch(t){}},o.prototype.onTouchEnd=function(t){this.sendBack()},o.prototype.registerTouch=function(){this.node.on("touchstart",this.onTouchStart,this),this.node.on("touchend",this.onTouchEnd,this),this.node.on("touchcancel",this.onTouchEnd,this)},o.prototype.unregisterTouch=function(){this.node.off("touchstart",this.onTouchStart,this),this.node.off("touchend",this.onTouchEnd,this),this.node.off("touchcancel",this.onTouchEnd,this)},o.prototype.onDestroy=function(){cc.audioEngine.stopAllEffects(),this.unregisterTouch()},r([c(cc.AudioClip)],o.prototype,"loadAudio",void 0),r([c(cc.AudioClip)],o.prototype,"touchAudio",void 0),r([u.default()],o.prototype,"onLoad",null),r([u.default()],o.prototype,"showLabel",null),r([u.default()],o.prototype,"hideLabel",null),r([u.default()],o.prototype,"playLoadingSound",null),r([u.default()],o.prototype,"reCount",null),r([u.default()],o.prototype,"count",null),o=r([i],o)}(cc.Component);n.default=a,cc._RF.pop()},{"../../../common/scripts/lib/error-handler":void 0,"../../../common/scripts/util":void 0}],total:[function(t,o,n){"use strict";cc._RF.push(o,"84d22OfiahGMrOGwaiLgxHi","total");var e=this&&this.__extends||function(){var t=function(o,n){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,o){t.__proto__=o}||function(t,o){for(var n in o)o.hasOwnProperty(n)&&(t[n]=o[n])})(o,n)};return function(o,n){function e(){this.constructor=o}t(o,n),o.prototype=null===n?Object.create(n):(e.prototype=n.prototype,new e)}}(),r=this&&this.__decorate||function(t,o,n,e){var r,i=arguments.length,c=i<3?o:null===e?e=Object.getOwnPropertyDescriptor(o,n):e;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,o,n,e);else for(var s=t.length-1;s>=0;s--)(r=t[s])&&(c=(i<3?r(c):i>3?r(o,n,c):r(o,n))||c);return i>3&&c&&Object.defineProperty(o,n,c),c};Object.defineProperty(n,"__esModule",{value:!0});var i=cc._decorator.ccclass,c=cc._decorator.property,s=t("../../../common/scripts/lib/config"),u=t("../../../common/scripts/util"),a=t("../../../common/scripts/lib/error-handler"),l=t("../../../common/scripts/counting-answer"),p=t("./counting-item"),h=t("../../../common/scripts/answer-grid"),f=function(t){function o(){var o=null!==t&&t.apply(this,arguments)||this;return o.layoutPrefab=null,o.countingAnswerPrefab=null,o.countingQuestionPrefab=null,o.stone1Prefab=null,o.stone2Prefab=null,o.stone3Prefab=null,o.stone4Prefab=null,o.stone5Prefab=null,o.branch1Prefab=null,o.branchesPrefab=null,o._layout=null,o._countingQuestion=null,o._countingAnswer=null,o._currentConfig=null,o._stoneTypes=["stone1","stone2","stone3","stone4","stone5"],o._randomPositions=[],o._currentCount=0,o._totalCount=null,o._answeredCorrectly=!1,o._recountInProgress=!1,o}return e(o,t),o.prototype.onLoad=function(){var t=this;this._currentConfig=this.processConfiguration(s.default.getInstance().data[0]),this._layout=cc.instantiate(this.layoutPrefab),this._totalCount=this._currentConfig.stoneCount&&this._currentConfig.stoneCount!==this._currentConfig.numberpads[0]?this._currentConfig.stoneCount:this._currentConfig.tallyCount&&this._currentConfig.tallyCount!==this._currentConfig.numberpads[0]?this._currentConfig.tallyCount:null,this.setUpLayout(),this.node.addChild(this._layout),this.node.on(l.VALIDATE_RESULT,function(o){o.stopPropagation();var n=o.getUserData(),e=t._totalCount;!t._answeredCorrectly&&n.result&&n.result===e?(t._answeredCorrectly=!0,t._countingAnswer.getComponent(l.default).isValidResult=!0,t.correctAnimations()):t._answeredCorrectly||(t._countingAnswer.getComponent(l.default).isValidResult=!1,t.wrongAnimations())}),this.node.on(h.HELP_BTN,function(o){o.stopPropagation();var n=o.getUserData();t.showHelp(t.helpIterator(n.helpNodes))})},o.prototype.helpIterator=function(t){return t[Symbol.iterator]()},o.prototype.showHelp=function(t){var o=this,n=t.next();n.done||u.Util.showHelp(n.value,n.value,function(){o.showHelp(t)})},o.prototype.correctAnimations=function(){var t=this;setTimeout(function(){t.node.emit("correct")},2e3);try{u.Util.speakEquation([String(this._totalCount)],function(o){t.node.emit("nextProblem")})}catch(t){this.node.emit("nextProblem")}},o.prototype.wrongAnimations=function(){var t=this;this.node.emit("wrong"),this._countingAnswer.getComponent(l.default).clearDigits(!1),this.scheduleOnce(function(){t.reCount()},.25)},o.prototype.hideItems=function(){this._countingQuestion.children.forEach(function(t,o){t.getComponent(p.default).hideLabel()})},o.prototype.reCount=function(){var t=this;this._recountInProgress||(this.hideItems(),this._recountInProgress=!0,this.currentCount=0,this._countingQuestion.children.forEach(function(o,n){(new cc.Tween).target(o).to(.5+.2*n,{opacity:255},null).call(function(){o.getComponent(p.default).reCount()}).call(function(){t._countingQuestion.children.length-1===n&&(t._recountInProgress=!1)}).start()}))},o.prototype.setUpLayout=function(){this._countingQuestion=cc.instantiate(this.countingQuestionPrefab),this._countingQuestion.height=cc.winSize.height,this._layout.addChild(this._countingQuestion),this.addStonesOrBranches(),this._countingAnswer=cc.instantiate(this.countingAnswerPrefab);var t=this._countingAnswer.getComponent(l.default);t.numberpads=this._currentConfig.numberpads,t.result=this._totalCount,this._layout.addChild(this._countingAnswer)},o.prototype.addStonesOrBranches=function(){if(this._currentConfig.stoneCount&&this._currentConfig.stoneCount!==this._currentConfig.numberpads[0]&&this._currentConfig.stoneCount.length>0)this._randomPositions=u.Util.generatePositionsArray(this._countingQuestion.width,this._countingQuestion.height-20,100,30),this.createStones(Number(this._currentConfig.stoneCount)),this.animate(Number(this._currentConfig.stoneCount));else if(this._currentConfig.tallyCount&&this._currentConfig.tallyCount.length>0){var t=Math.floor(Number(this._currentConfig.tallyCount)/5),o=Number(this._currentConfig.tallyCount)%5;this._randomPositions=u.Util.generatePositionsArray(this._countingQuestion.width-40,this._countingQuestion.height-40,150,50),this.createBranches(t,o),this.animate(t+o)}},o.prototype.createStones=function(t){for(var o=0;o<t;o++){var n=this._stoneTypes[o%5],e=cc.instantiate(this[n+"Prefab"]);e.name="stone"+o,this._countingQuestion.addChild(e),e.getComponent(p.default).countingComponent=this,e.setPosition(new cc.Vec2(this._randomPositions[o].x,cc.winSize.height+100))}},o.prototype.animate=function(t){var o=this;this._countingQuestion.children.forEach(function(t,n){(new cc.Tween).target(t).to(.5+.2*n/4,{position:new cc.Vec2(o._randomPositions[n].x,o._randomPositions[n].y)},null).call(function(){t.getComponent(p.default).playLoadingSound()}).start()})},o.prototype.createBranches=function(t,o){for(var n=0;n<t;n++){(r=cc.instantiate(this.branchesPrefab)).name="branches"+n,this._countingQuestion.addChild(r);var e=r.getComponent(p.default);e.countingComponent=this,e.isBranches=!0,r.setPosition(new cc.Vec2(this._randomPositions[n].x,cc.winSize.height+100))}for(n=t;n<t+o;n++){var r;(r=cc.instantiate(this.branch1Prefab)).name="branch"+n,this._countingQuestion.addChild(r),r.getComponent(p.default).countingComponent=this,r.setPosition(new cc.Vec2(this._randomPositions[n].x,cc.winSize.height+100))}},o.prototype.processConfiguration=function(t){void 0===t&&(t=[]);var o=[].concat.apply([],t),n=o[0],e=o[1],r=o[2],i=o[3],c=o[4],s=o[5];return{level:n,workSheet:e,problem:r,stoneCount:i,tallyCount:c,numberpads:s=s.split(",")}},Object.defineProperty(o.prototype,"currentCount",{get:function(){return this._currentCount},set:function(t){this._currentCount=t},enumerable:!1,configurable:!0}),o.prototype.updateCount=function(t){void 0===t&&(t=1);for(var o=0;o<t;o++)this._currentCount++;return this.currentCount},Object.defineProperty(o.prototype,"currentConfig",{get:function(){return this._currentConfig},enumerable:!1,configurable:!0}),r([c(cc.Prefab)],o.prototype,"layoutPrefab",void 0),r([c(cc.Prefab)],o.prototype,"countingAnswerPrefab",void 0),r([c(cc.Prefab)],o.prototype,"countingQuestionPrefab",void 0),r([c(cc.Prefab)],o.prototype,"stone1Prefab",void 0),r([c(cc.Prefab)],o.prototype,"stone2Prefab",void 0),r([c(cc.Prefab)],o.prototype,"stone3Prefab",void 0),r([c(cc.Prefab)],o.prototype,"stone4Prefab",void 0),r([c(cc.Prefab)],o.prototype,"stone5Prefab",void 0),r([c(cc.Prefab)],o.prototype,"branch1Prefab",void 0),r([c(cc.Prefab)],o.prototype,"branchesPrefab",void 0),r([a.default()],o.prototype,"onLoad",null),r([a.default()],o.prototype,"helpIterator",null),r([a.default()],o.prototype,"showHelp",null),r([a.default()],o.prototype,"correctAnimations",null),r([a.default()],o.prototype,"wrongAnimations",null),r([a.default()],o.prototype,"hideItems",null),r([a.default()],o.prototype,"reCount",null),r([a.default()],o.prototype,"setUpLayout",null),r([a.default()],o.prototype,"addStonesOrBranches",null),r([a.default()],o.prototype,"createStones",null),r([a.default()],o.prototype,"animate",null),r([a.default()],o.prototype,"createBranches",null),o=r([i],o)}(cc.Component);n.default=f,cc._RF.pop()},{"../../../common/scripts/answer-grid":void 0,"../../../common/scripts/counting-answer":void 0,"../../../common/scripts/lib/config":void 0,"../../../common/scripts/lib/error-handler":void 0,"../../../common/scripts/util":void 0,"./counting-item":"counting-item"}]},{},["clear-script","confirm-script","counting-item","total"]);