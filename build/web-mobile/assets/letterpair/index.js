window.__require=function t(e,o,n){function i(c,a){if(!o[c]){if(!e[c]){var d=c.split("/");if(d=d[d.length-1],!e[d]){var s="function"==typeof __require&&__require;if(!a&&s)return s(d,!0);if(r)return r(d,!0);throw new Error("Cannot find module '"+c+"'")}c=d}var l=o[c]={exports:{}};e[c][0].call(l.exports,function(t){return i(e[c][1][t]||t)},l,l.exports,t,e,o,n)}return o[c].exports}for(var r="function"==typeof __require&&__require,c=0;c<n.length;c++)i(n[c]);return i}({card:[function(t,e,o){"use strict";cc._RF.push(e,"74bbfoi9P1BsLbPdPwWvpFP","card");var n=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,c=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(c=(r<3?i(c):r>3?i(e,o,c):i(e,o))||c);return r>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var r=t("../../../common/scripts/util"),c=t("./letterpair"),a=t("../../../common/scripts/chimple-label"),d=t("../../../common/scripts/countingLayout"),s=cc._decorator,l=s.ccclass,p=s.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cardParticle=null,e.explodeParticle=null,e.countingLayout=null,e.pickupAudio=null,e.correctAudio=null,e.wordAudio=null,e.textFont=null,e.square=null,e.rectangle=null,e.block=null,e.pairCard=null,e.particleNode=null,e.cardType=null,e.cardContent=null,e.cardText=null,e.cardFontSize=null,e.cardFontColor=null,e.cardBgType=null,e.cardBgColor=null,e.audio=null,e.isInteracting=!1,e}var o;return n(e,t),o=e,e.prototype.onLoad=function(){var t=this;this.node.on("touchstart",this.onTouchStart,this),this.node.on("touchend",this.onTouchEnd,this),this.node.on("touchcancel",this.onTouchEnd,this),this.node.on("touchmove",this.onTouchMove,this);var e=null,o=null,n="rectangle"==this.cardBgType?cc.instantiate(this.rectangle):cc.instantiate(this.square);if(e=n.getChildByName("giftbox"),o=n.getChildByName("giftboxwhite"),this.node.addChild(n),"image"==this.cardType||"rotate"==this.cardType)r.Util.loadTexture(this.cardContent,function(e){var o=new cc.Node("frontSprite");o.addComponent(cc.Sprite).spriteFrame=new cc.SpriteFrame(e),"rotate"==t.cardType&&(o.angle=90),o.scale=.9,t.node.addChild(o)});else if("number"==this.cardType||"stick"==this.cardType)r.Util.loadTexture(this.cardContent,function(e){var o=cc.instantiate(t.countingLayout),n=o.getComponent(d.default);if(n.fullCount=parseInt(t.cardText),n.scale=.4,n.fullTexture=new cc.SpriteFrame(e),"stick"==t.cardType){var i=n.getComponent(cc.Layout);i.paddingLeft=50,i.paddingRight=50}t.node.addChild(o)}),0==this.audio.length&&r.Util.loadNumericSound(this.cardText,function(e){t.wordAudio=e});else{var i=new cc.Node("label"),c=i.addComponent(a.default);c.string=this.cardText,c.font=this.textFont;var s=cc.Color.BLACK;if(""!=this.cardFontColor&&s.fromHEX(this.cardFontColor),i.color=s,""!=this.cardFontSize){var l=parseInt(this.cardFontSize);c.fontSize=l,c.lineHeight=l,i.position=new cc.Vec2(0,.1*l)}this.node.addChild(i),0==this.audio.length&&(isNaN(parseInt(this.cardText))?r.Util.loadsLetter(this.cardText,function(e){t.wordAudio=e}):r.Util.loadNumericSound(this.cardText,function(e){t.wordAudio=e}))}if(""!=this.cardBgColor){var p=new cc.Color;p.fromHEX(this.cardBgColor),"rectangle"==this.cardBgType&&"image"==this.cardType?o.color=p:e.color=p}this.audio.length>0&&r.Util.loadGameSound(this.audio,function(e){t.wordAudio=e})},e.prototype.start=function(){var t=this.node.name.charAt(this.node.name.length-1),e=this.node.name.substr(0,this.node.name.length-1)+("1"==t?"2":"1");this.pairCard=this.node.parent.getChildByName(e).getComponent(o)},e.prototype.onDestroy=function(){this.unregisterTouch()},e.prototype.unregisterTouch=function(){this.node.off("touchstart",this.onTouchStart,this),this.node.off("touchend",this.onTouchEnd,this),this.node.off("touchcancel",this.onTouchEnd,this),this.node.off("touchmove",this.onTouchMove,this)},e.prototype.onTouchStart=function(t){this.node.parent.parent.getComponent(c.default);o.letDrag&&(o.letDrag=!1,this.isInteracting=!0,this.node.zIndex=3,r.Util.playSfx(this.pickupAudio),this.node.setSiblingIndex(this.node.parent.childrenCount-1),(new cc.Tween).target(this.node).to(.25,{scale:1.1},{progress:null,easing:"sineOut"}).start())},e.prototype.onTouchMove=function(t){this.isInteracting&&(this.node.setPosition(this.node.position.add(t.getDelta())),this.node.getBoundingBoxToWorld().intersects(this.pairCard.node.getBoundingBoxToWorld())?(this.sparkle(),null!=this.particleNode&&(this.pairCard.node.setSiblingIndex(this.node.parent.childrenCount-2),(new cc.Tween).target(this.pairCard.node).to(.25,{scale:1.1},{progress:null,easing:"elasticOut"}).start(),this.pairCard.node.zIndex=2,this.pairCard.sparkle())):(this.unSparkle(),(new cc.Tween).target(this.pairCard.node).to(.25,{scale:1},{progress:null,easing:"elasticOut"}).start(),this.pairCard.node.zIndex=0,this.pairCard.unSparkle()))},e.prototype.onTouchEnd=function(t){var e=this;if(this.isInteracting)if(null!=this.particleNode){var n=cc.instantiate(this.block),i=n.getComponent(cc.Widget);null!=i&&(i.target=cc.director.getScene()),this.node.parent.addChild(n),n.opacity=224,n.zIndex=1,this.node.parent.parent.emit("correct"),this.unregisterTouch(),this.unSparkle(),(new cc.Tween).target(this.node).to(.25,{position:this.pairCard.node.position,scale:1},{progress:null,easing:"elasticOut"}).delay(.5).call(function(){null!=e.wordAudio&&r.Util.play(e.wordAudio,!1)}).to(.5,{position:cc.v2(-this.node.width/2-20,0)},null).delay(.5).call(function(){var t=cc.instantiate(e.explodeParticle);t.position=e.node.position,e.node.parent.addChild(t);var i=e.node.parent.parent.getComponent(c.default);i.scheduleOnce(function(){n.destroy(),o.letDrag=!0,e.isInteracting=!1,i.drop(!0),e.pairCard.node.destroy(),e.node.destroy()},.25),i.scheduleOnce(function(){t.destroy()},.5)}).start(),this.pairCard.unSparkle(),(new cc.Tween).target(this.pairCard.node).to(.25,{scale:1},{progress:null,easing:"elasticOut"}).delay(.5).to(.5,{position:cc.v2(this.node.width/2+20,0)},null).delay(.5).call(function(){var t=cc.instantiate(e.explodeParticle);t.position=e.pairCard.node.position,e.node.parent.addChild(t),e.node.parent.parent.getComponent(c.default).scheduleOnce(function(){t.destroy()},.5)}).start()}else this.node.parent.parent.emit("wrong"),(new cc.Tween).target(this.node).to(.25,{scale:1,position:this.node.position.clampf(new cc.Vec2(this.node.width-cc.winSize.width,this.node.height-cc.winSize.height).mul(.5),new cc.Vec2(cc.winSize.width-this.node.width,cc.winSize.height-this.node.height).mul(.5))},{progress:null,easing:"sineOut"}).call(function(){var t=e.node.parent.parent.getComponent(c.default);o.letDrag=!0,e.isInteracting=!1,e.node.zIndex=0,e.pairCard.node.zIndex=0,t.drop(!1)}).start(),this.node.parent.children.forEach(function(t){if(t!=e.node&&t.getBoundingBox().intersects(e.node.getBoundingBox())){var o=new cc.Rect;t.getBoundingBox().intersection(o,e.node.getBoundingBox());var n=new cc.Vec2(o.width/t.getBoundingBox().width,o.height/t.getBoundingBox().height),i=t.position.add(t.position.sub(e.node.position).scale(n).mul(2)).clampf(new cc.Vec2(t.getBoundingBox().width-cc.winSize.width,t.getBoundingBox().height-cc.winSize.height).mul(.5),new cc.Vec2(cc.winSize.width-t.getBoundingBox().width,cc.winSize.height-t.getBoundingBox().height).mul(.5));(new cc.Tween).target(t).to(.5,{position:i},{progress:null,easing:"quadOut"}).start()}})},e.prototype.sparkle=function(){null==this.particleNode&&(this.particleNode=cc.instantiate(this.cardParticle),this.node.addChild(this.particleNode,1,"particle"))},e.prototype.unSparkle=function(){null!=this.particleNode&&(this.node.removeChild(this.particleNode),this.particleNode=null)},e.letDrag=!0,i([p(cc.Prefab)],e.prototype,"cardParticle",void 0),i([p(cc.Prefab)],e.prototype,"explodeParticle",void 0),i([p(cc.Prefab)],e.prototype,"countingLayout",void 0),i([p({type:cc.AudioClip})],e.prototype,"pickupAudio",void 0),i([p({type:cc.AudioClip})],e.prototype,"correctAudio",void 0),i([p(cc.AudioClip)],e.prototype,"wordAudio",void 0),i([p({type:cc.Font})],e.prototype,"textFont",void 0),i([p(cc.Prefab)],e.prototype,"square",void 0),i([p(cc.Prefab)],e.prototype,"rectangle",void 0),i([p(cc.Prefab)],e.prototype,"block",void 0),e=o=i([l],e)}(cc.Component);o.default=u,cc._RF.pop()},{"../../../common/scripts/chimple-label":void 0,"../../../common/scripts/countingLayout":void 0,"../../../common/scripts/util":void 0,"./letterpair":"letterpair"}],letterpair:[function(t,e,o){"use strict";cc._RF.push(e,"93765v8zaxLGJHiUW+Jazhw","letterpair");var n=this&&this.__extends||function(){var t=function(e,o){return(t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)e.hasOwnProperty(o)&&(t[o]=e[o])})(e,o)};return function(e,o){function n(){this.constructor=e}t(e,o),e.prototype=null===o?Object.create(o):(n.prototype=o.prototype,new n)}}(),i=this&&this.__decorate||function(t,e,o,n){var i,r=arguments.length,c=r<3?e:null===n?n=Object.getOwnPropertyDescriptor(e,o):n;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,o,n);else for(var a=t.length-1;a>=0;a--)(i=t[a])&&(c=(r<3?i(c):r>3?i(e,o,c):i(e,o))||c);return r>3&&c&&Object.defineProperty(e,o,c),c};Object.defineProperty(o,"__esModule",{value:!0});var r=t("./card"),c=t("../../../common/scripts/lib/config"),a=t("../../../common/scripts/util"),d=t("../../../common/scripts/lib/error-handler"),s=cc._decorator,l=s.ccclass,p=s.property,u=function(t){function e(){var e=null!==t&&t.apply(this,arguments)||this;return e.cardPrefab=null,e.progressMonitorPrefab=null,e.totalPieces=0,e.isInteracting=!1,e}return n(e,t),e.prototype.onLoad=function(){for(var t=c.default.getInstance().data[0],e=2*Math.floor((t.length-5)/13),o=Array(e/2),n=0;n<e;n++){for(var i=Math.floor(Math.random()*e);null!=o[i];)i=(i+1)%e;o[i]=n}for(var d=(cc.winSize.width-80)/e*2,s=(cc.winSize.height-160)/2,l=0,p=t[3],u=t[4],h=0;h<e/2;h++){var f=cc.instantiate(this.cardPrefab);f.name=l+"1";var g=f.getComponent(r.default);g.cardType=p,g.cardContent=t[13*h+5],g.cardText=t[13*h+6],g.cardFontSize=t[13*h+7],g.cardFontColor=t[13*h+8],g.cardBgType=t[13*h+9],g.cardBgColor=t[13*h+10],g.audio=t[13*h+17],f.position=new cc.Vec2(d*(o[l]%(e/2))+Math.random()*(d-80)-cc.winSize.width/2+80,s*Math.floor(o[l]/e*2)+Math.random()*(s-80)-cc.winSize.height/2+80);var y=cc.instantiate(this.cardPrefab);y.name=l+"2",l++;var m=y.getComponent(r.default);m.cardType=u,m.cardContent=t[13*h+11],m.cardText=t[13*h+12],m.cardFontSize=t[13*h+13],m.cardFontColor=t[13*h+14],m.cardBgType=t[13*h+15],m.cardBgColor=t[13*h+16],m.audio=t[13*h+17],y.position=new cc.Vec2(d*(o[l]%(e/2))+Math.random()*(d-80)-cc.winSize.width/2+80,s*Math.floor(o[l]/e*2)+Math.random()*(s-80)-cc.winSize.height/2+80),this.node.getChildByName("CardContainer").addChild(f),this.node.getChildByName("CardContainer").addChild(y),l++,this.totalPieces++,2==l&&a.Util.showHelp(f,y)}r.default.letDrag=!0},e.prototype.drop=function(t){this.isInteracting=!1,t&&--this.totalPieces<=0&&this.node.emit("nextProblem")},e.prototype.drag=function(){return!this.isInteracting&&(this.isInteracting=!0,!0)},i([p(cc.Prefab)],e.prototype,"cardPrefab",void 0),i([p(cc.Prefab)],e.prototype,"progressMonitorPrefab",void 0),i([d.default()],e.prototype,"onLoad",null),e=i([l],e)}(cc.Component);o.default=u,cc._RF.pop()},{"../../../common/scripts/lib/config":void 0,"../../../common/scripts/lib/error-handler":void 0,"../../../common/scripts/util":void 0,"./card":"card"}]},{},["card","letterpair"]);